name: Emergency Debug
on:
  workflow_dispatch:

jobs:
  debug_job:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '24'

      - name: Run Scraper
        env:
          MONEYMAN_CONFIG: ${{ secrets.MONEYMAN_CONFIG }}
        run: |
          echo "--- LOG START ---" > results.txt
          npm install >> results.txt 2>&1
          echo "Starting Scrape..." >> results.txt
          npx tsx src/index.ts scrape >> results.txt 2>&1 || echo "Run failed" >> results.txt
          echo "--- LOG END ---" >> results.txt

      - name: Push Results
        run: |
          git config --global user.name "Debug Bot"
          git config --global user.email "bot@debug.com"
          git add results.txt
          git commit -m "Update logs" || exit 0
          git push
          git push"
